import open3d as o3d
import numpy as np

# 1. 读取PLY文件
ply_file = "/home/xuyuan/pan/xybag/scene0000_00_vh_clean_2.labels.ply"   # 替换成你的PLY文件路径
mesh = o3d.io.read_triangle_mesh(ply_file)

# 2. 提取顶点数据
vertices = np.asarray(mesh.vertices)

# 3. 假设你有一列顶点索引，你可以将它定义为一个列表或数组
vertex_indices = [43652,
        43832,
        43632,
        53294,
        44062,
        44013,
        44158,
        53070,
        53173,
        53253,
        77796,
        77832,
        78722,
        42731,
        42300,
        43161,
        40270,
        41048,
        50223,
        41919,
        49593,
        49628,
        51919,
        48329,
        50194,
        38790,
        49958,
        41692,
        40672,
        39867,
        40054,
        40065,
        40400,
        51890,
        41630,
        41970,
        42213,
        43106,
        43164,
        49651,
        49813,
        50107,
        50313,
        67857,
        68082,
        68224,
        70807,
        70410,
        71001,
        71261,
        70733,
        70131,
        70098,
        70528,
        70206,
        55339,
        55179,
        54931,
        57679,
        55000,
        57422,
        56503,
        56699,
        71582,
        57386,
        56458,
        57460,
        17909,
        3376,
        3849,
        4241,
        273,
        17737,
        3454,
        1015,
        3703,
        4603,
        3441,
        3449,
        3295,
        3137,
        4080,
        6708,
        4886,
        4421,
        4046,
        4029,
        4680,
        4754,
        7611,
        7586,
        6660,
        687,
        7659,
        768,
        7059,
        7046,
        1465,
        49,
        1067,
        5753,
        5778,
        6574,
        6778,
        5004,
        5242,
        7163,
        16897,
        34411,
        34769,
        23667,
        34893,
        23501,
        34142,
        34809,
        33377,
        33157,
        34470,
        23885,
        33455,
        23627,
        23486,
        23127,
        23165,
        22863,
        22812,
        23894,
        34347,
        23108,
        16065,
        25338,
        25327,
        24563,
        24275,
        24492,
        24729,
        25096,
        25354,
        24096,
        14406,
        14696,
        22509,
        33670,
        22687,
        24206,
        24274,
        24522,
        25123,
        33699,
        32746,
        33892,
        33741,
        9802,
        10871,
        11898,
        478,
        10055,
        7883,
        2460,
        8750,
        2515,
        12084,
        11554,
        10037,
        10808,
        11696,
        11567,
        11753,
        1989,
        11947,
        12379,
        8615,
        10853,
        11759,
        9498,
        1629,
        1758,
        10832,
        12289,
        11955,
        9403,
        9265,
        9441,
        9981,
        8448,
        2006,
        11671,
        2325,
        2224,
        2121,
        11109,
        11727,
        10586,
        12114,
        17323,
        20127,
        73589,
        28415,
        27500,
        25637,
        21015,
        20860,
        14749,
        45751,
        24756,
        80457,
        59910,
        46965,
        79898,
        79778,
        79753,
        79922,
        79355,
        79026,
        59805,
        63215,
        75690,
        75461,
        63068,
        76063,
        75602,
        75615,
        24579,
        31871,
        31995,
        10332,
        11195,
        10099,
        10059,
        10046,
        44500,
        44905,
        44717,
        16381,
        18741,
        18822,
        18471,
        18708,
        54179,
        34817,
        54614,
        22990,
        33544,
        45485,
        13939,
        23237,
        14265,
        53785,
        33790,
        33230,
        24054,
        22674,
        53836,
        53902,
        16802,
        1368,
        220,
        1298,
        1946,
        16669,
        16264,
        14916,
        16017,
        16761,
        17862,
        17834,
        3824,
        15288,
        69943,
        31031,
        44229,
        43272,
        44072,
        44095,
        41770,
        52759,
        43189,
        52711,
        52424,
        60867,
        60808,
        60148,
        60297,
        60009,
        59539,
        59797,
        77408,
        76133,
        77388,
        81336,
        76731,
        73471,
        74765,
        69267,
        66976,
        67487,
        79281,
        79752,
        79544,
        78378,
        80947,
        80550,
        80852,
        62440,
        72734,
        62204,
        61528,
        57212,
        59674,
        58935,
        58870,
        56869,
        70580,
        78567,
        50356,
        50173,
        48586,
        48813,
        48493,
        48905,
        48889,
        49445,
        48896,
        48941,
        51509,
        50950,
        50531,
        51769,
        51300,
        50393,
        50642,
        41953,
        41925,
        52398,
        43250,
        41748,
        43017,
        41097,
        51726,
        40028,
        39616,
        40396,
        38506,
        37962,
        26891,
        38407,
        37978,
        19956,
        39064,
        29740,
        40766,
        38278,
        40024,
        29817,
        40774,
        28239,
        48215,
        48061,
        37702,
        19529,
        37640,
        38806,
        37289,
        27293,
        27225,
        26945,
        27160,
        19636,
        27048,
        26492,
        27891,
        36929,
        27233,
        48275,
        48234,
        38054,
        37639,
        27150,
        26548,
        19808,
        26808,
        19759,
        38286,
        39558,
        19012,
        38000,
        37908,
        27366,
        28300,
        37493,
        39829,
        37762,
        38995,
        63588,
        65912,
        63584,
        65851,
        63955,
        65551,
        64435,
        20246,
        27556,
        27989,
        20378,
        20060,
        27392,
        27506,
        27641,
        27651,
        15226,
        17386,
        17347,
        16975,
        17653,
        14899,
        17437,
        3098,
        16949,
        17635,
        15283,
        79208,
        78808,
        77731,
        77534,
        77556,
        46419,
        44601,
        35641,
        47427,
        35153,
        31549,
        36306,
        47059,
        46324,
        36050,
        35039,
        45680,
        53892,
        46084,
        47252,
        45655,
        45671,
        45572,
        72284,
        74632,
        75092,
        74941,
        74180,
        74375,
        74838,
        75098,
        74743,
        72486,
        81163,
        74522,
        71609,
        14817,
        15961,
        15615,
        13812,
        16045,
        16306,
        13412,
        16856,
        15819,
        15845,
        13370,
        66304,
        66336,
        63966,
        65932,
        76563,
        64154,
        76595,
        58280,
        58380,
        57913,
        58443,
        66744,
        65587,
        64500,
        67365,
        65068,
        68710,
        66256,
        69782,
        60462,
        60887,
        55164,
        65428,
        65461,
        55557,
        54701,
        55615,
        57025,
        58805,
        62111,
        60260,
        60668,
        60558,
        59000,
        34076,
        33227,
        33947,
        31920,
        31586,
        56794,
        55610,
        57062,
        67723,
        68069,
        67532,
        67021,
        67489,
        68419,
        66811,
        67249,
        65858,
        65869,
        67401,
        75523,
        69079,
        69047,
        45475,
        69361,
        69403,
        13211,
        23799,
        57901,
        22027,
        21793,
        29107,
        20878,
        29171,
        20701,
        31224,
        22193,
        30393,
        13143,
        29062,
        21680,
        30486,
        21890,
        21608,
        21902,
        22291,
        28943,
        29141,
        29873,
        31033,
        29331,
        12763,
        12767,
        30203,
        12854,
        28716,
        29045,
        29438,
        29626,
        29710,
        29773,
        29954,
        30772,
        21623,
        10761,
        6260,
        7259,
        5728,
        6252,
        7397,
        6785,
        5154,
        6453,
        8831,
        5833,
        8393,
        7851,
        892,
        8714,
        8991,
        5089,
        5187,
        6054,
        7044,
        6144,
        5585,
        3072,
        33466,
        33457,
        56157,
        56914,
        36492,
        36416,
        35817,
        35499,
        73190,
        72232,
        72768,
        61867,
        72268,
        62136,
        80184,
        81097,
        76295,
        73625,
        75146,
        76266,
        39048,
        40612]   # 你想获取坐标的索引列表

# 4. 获取这些顶点的坐标
target_vertices = vertices[vertex_indices]  # 通过索引提取多个顶点的坐标
print("Target Vertices:")
print(target_vertices)

# 5. 创建新的点云对象存储这些目标顶点
point_cloud = o3d.geometry.PointCloud()
point_cloud.points = o3d.utility.Vector3dVector(target_vertices)

# 6. 创建连接这些顶点的线段（边）
lines = []
for i in range(len(target_vertices) - 1):
    lines.append([i, i + 1])  # 连接相邻的点

# 如果需要一个封闭的环形连接最后一个点与第一个点
lines.append([len(target_vertices) - 1, 0])

# 创建 LineSet 对象来表示这些连接
line_set = o3d.geometry.LineSet()
line_set.points = o3d.utility.Vector3dVector(target_vertices)
line_set.lines = o3d.utility.Vector2iVector(lines)

# 7. 为了更好区分，给点云和线段上色
point_cloud.paint_uniform_color([0, 1, 0])  # 绿色顶点
line_set.paint_uniform_color([0, 0, 1])    # 蓝色线段

# 8. 可视化：单独生成点和边的图形
o3d.visualization.draw_geometries([point_cloud, line_set])

